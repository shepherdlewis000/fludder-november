<% if (!user) { %>
<script>
  window.location.href = "/login";
</script>
<p>
  This site works best with Javascript enabled. If you'd like to try it anyway,
  click <a href="/login">here</a>.
</p>

<% } else { %>

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>Add New Article - Fludder</title>
    <meta
      name="description"
      content="Simple note-taking app exercise using Node/Express, Passport.js local auth and MongoDB/Mongoose."
    />
    <link rel="stylesheet" href="/css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Lato:300,400,700"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css"
    />
    <!--
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.6.1/css/pikaday.min.css"
    /> -->
    <link rel="stylesheet" href="/css/Login-Form-Dark.css" />
    <!--
    <link rel="stylesheet" href="/css/Profile-Edit-Form-1.css" />
    -->
    <link rel="stylesheet" href="/css/Profile-Edit-Form.css" />
    <link rel="stylesheet" href="/css/pell.css" />
  </head>

  <body>
    <nav
      class="navbar navbar-dark navbar-expand-lg fixed-top bg-white portfolio-navbar gradient"
    >
      <div class="container">
        <a class="navbar-brand logo" href="/">Fludder</a
        ><button
          data-toggle="collapse"
          class="navbar-toggler"
          data-target="#navbarNav"
        >
          <span class="sr-only">Toggle navigation</span
          ><span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="nav navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="/dashboard">Dashboard</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/all_articles">Articles</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/logout">Logout</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <main class="page hire-me-page">
      <section class="portfolio-block hire-me">
        <div class="container">
          <div class="heading" id="#addArticleHeading">
            <h2>ADD NEW ARTICLE</h2>
          </div>
        </div>
        <div class="container profile profile-view" id="profile">
          <div class="row">
            <div class="col-md-12 alert-col relative">
              <!-- this is some unknown stuff i think REMOVE -->
              <div class="alert alert-info absolue center" role="alert">
                <button
                  type="button"
                  class="close"
                  data-dismiss="alert"
                  aria-label="Close"
                >
                  <span aria-hidden="true">Ã—</span></button
                ><span>Profile save with success</span>
              </div>
            </div>
          </div>
          <form action="/posted" method="POST" enctype="multipart/form-data">
            <div class="form-row profile-row">
              
              <div id="photoArea" class="col-12 col-md-12 col-lg-12 col-xl-12 text-center relative">
                
                <div class="avatar">
                  <!-- <img
                    class="rounded img-fluid"
                    style="width: 400; height: 400"
                    src="img/photo-upload-240x240.png"
                    alt="Story image area"
                    width="240"
                    height="240"
                  /> -->
                  <div>
                    <img
                      id="photo1"
                      class="rounded img-fluid mb-3"
                      src="img/photo-upload-240x240.png"
                      alt="Story image area"
                    />
                  </div>
                  <img id="photoPrev" class="img-fluid"></img>
                </div>
                
                <!-- Might be good to try accept="image/*" -->
                <input
                  type="file"
                  data-toggle="tooltip"
                  data-bs-tooltip=""
                  data-placement="bottom"
                  class="form-control"
                  name="photoupload"
                  accept="image/png, image/jpeg"
                  title="This is optional"
                  onchange="preview_image(event)";
                />
              </div>
              
              <div class="col-12"></div>
              <div class="col-md-12 col-lg-12 col-xl-12">
                <hr />
                <div class="form-row">
                  <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                    <div class="form-group">
                      <label>Title</label
                      ><input
                        class="form-control"
                        type="text"
                        name="title"
                        required=""
                      />
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label>Subtitle</label
                  ><input
                    class="form-control"
                    type="text"
                    autocomplete="off"
                    required=""
                    name="subtitle"
                  />
                </div>
                <div class="form-row">
                  <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                    <!-- 
                    <div class="form-group">
                      <label>Text</label>
                      <textarea
                        class="form-control form-control-lg"
                        rows="10"
                        name="txt"
                      ></textarea>
                    </div>
                    -->
                    <input id="txt" type="hidden" name="txt" />

                    <div id="editor" class="pell"></div>


                    <div class="test-output">
                      
                      <h3 class="mt-3 mb-3">Article preview:</h3>
                      <div id="text-output"></div>
                    
                      <!-- this is just raw html displayed as code
                      <h3 class="test-html-output">Html output:</h3>
                      <pre id="html-output"></pre>
                      -->
                    </div>
                  </div>
                </div>
                <hr />
                <div class="form-row">
                  <div class="col-md-12 content-right">
                    <button class="btn btn-primary form-btn" type="submit">
                      SAVE
                    </button>
                    <button class="btn btn-danger form-btn" type="reset">
                      CANCEL
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </section>
    </main>
    <footer class="page-footer">
      <div class="container">
        <div class="links"><a href="/about">About</a></div>
        <!-- <div class="social-icons"></div> -->
      </div>
    </footer>
    <!--
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

    <script src="/js/bs-init.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/pikaday/1.6.1/pikaday.min.js"></script> -->
    <script src="/js/Profile-Edit-Form.js"></script>
    <script src="/js/theme.js"></script>
    <script src="../../js/pell.js"></script>

    <script>

      function preview_image(event){
        console.log("preview_image called");
        var reader = new FileReader();
        reader.onload = function(){
          var output = document.getElementById('photo1');
          output.src = reader.result;
        }
        reader.readAsDataURL(event.target.files[0]);
      }// end function preview_image

      var editor = window.pell.init({
        actions: [
          "bold",
          "italic",
          "underline",
          "strikethrough",
          "paragraph",
          "quote",
          "olist",
          "ulist",
          "code",
          "line",
          "link",
        ],
        element: document.getElementById("editor"),
        defaultParagraphSeparator: "p",
        onChange: function (html) {
          document.getElementById("txt").value = html;
          document.getElementById("text-output").innerHTML = html;
          //document.getElementById("html-output").textContent = html;
        },
      });
    </script>
  </body>
</html>

<% } %>
